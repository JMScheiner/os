
#ifndef NAME
#error NAME undefined
#endif

#define PASTER(x, y) x ## _ ## y
#define EVALUATOR(x, y) PASTER(x, y)
#define ASM_NAME EVALUATOR(asm, NAME)

.globl ASM_NAME

/* Generate assembly wrapper for an interrupt or exception handler. 
 * TODO: What segment registers do we need to save? 
 */
ASM_NAME:
	pusha                /* Save user registers */
#ifdef IGNORE_THREAD_COUNT
	pushl $0
#else
	pushl $1
#endif
	call check_invariants
	popl %eax
	call NAME            /* Call handler function */
	cli
	call quick_fake_unlock
	call set_esp0_helper
	popa                 /* Restore user registers */
	addl $4, %esp        /* Pop the error code off the stack. */
	iret                 /* Return from interrupt */

#undef ASM_NAME
#undef NAME



